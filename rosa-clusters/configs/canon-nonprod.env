#------------------------------------------------------------------------------
# ROSA HCP Cluster Configuration: canon-nonprod
# Purpose: Canon USA Non-Production environment cluster
# Based on: Existing "rosa" cluster specification (2j8f2n27o4uou1912nm630a54rrjsn98)
# Created: 2026-01-23
#------------------------------------------------------------------------------
# Estimated Monthly Cost: ~$1,800/month
#   - ROSA HCP fee: ~$123/month
#   - 3x m5.2xlarge: ~$840/month
#   - NAT Gateways: ~$100/month
#   - Data transfer/storage: ~$50/month
#------------------------------------------------------------------------------

# Cluster identification
CLUSTER_NAME="canon-nonprod"
ENVIRONMENT="nonprod"

# AWS Configuration (same account as prod)
AWS_REGION="us-east-1"
AWS_BILLING_ACCOUNT="207621282346"

#------------------------------------------------------------------------------
# Cluster sizing - Recommended for nonprod
# Note: Prod uses r6i.metal ($3k/mo each) - using m5.2xlarge for cost savings
#------------------------------------------------------------------------------
REPLICAS=3                         # 3 workers across 3 AZs
INSTANCE_TYPE="m5.2xlarge"         # 8 vCPU, 32GB RAM per node
MULTI_AZ="true"                    # Multi-AZ for high availability

# Autoscaling
ENABLE_AUTOSCALING="true"
MIN_REPLICAS=3
MAX_REPLICAS=6

#------------------------------------------------------------------------------
# Networking - VPC Configuration
#------------------------------------------------------------------------------
# Using EXISTING VPC: ROSA-Non-Prod (vpc-0e9f579449a68a005)
# This VPC is already configured with:
#   - Aviatrix Transit Gateway attachment (tgw-041316428b4c331d0)
#   - Routing to corporate network and prod cluster
#   - 3 private subnets across 3 AZs
#------------------------------------------------------------------------------

# VPC: ROSA-Non-Prod
# VPC ID: vpc-0e9f579449a68a005
# VPC CIDR: 10.227.96.0/20

# Subnets (all private, across 3 AZs)
# subnet-008068c7368e05ff9 - us-east-1a - 10.227.96.0/22  (ROSA-Non-Prod-10.227.96.0/22)
# subnet-013a30e0e93221460 - us-east-1c - 10.227.100.0/22 (ROSA-Non-Prod-10.227.100.0/22)
# subnet-052579b87e36014dc - us-east-1d - 10.227.104.0/22 (ROSA-Non-Prod-10.227.104.0/22)
SUBNET_IDS="subnet-008068c7368e05ff9,subnet-013a30e0e93221460,subnet-052579b87e36014dc"

# Network CIDRs
MACHINE_CIDR="10.227.96.0/20"
SERVICE_CIDR="172.30.0.0/16"
POD_CIDR="10.128.0.0/14"
HOST_PREFIX=23

#------------------------------------------------------------------------------
# Access Control
#------------------------------------------------------------------------------
# Private cluster with PrivateLink (same as prod)
# Access via existing Site-to-Site VPN connection
PRIVATE_CLUSTER="true"

#------------------------------------------------------------------------------
# OpenShift Version
#------------------------------------------------------------------------------
# Match prod version (4.20.8) for compatibility testing
# Or use latest stable (4.20.10 available as of 2026-01-23)
OPENSHIFT_VERSION="4.20.8"

#------------------------------------------------------------------------------
# Tags
#------------------------------------------------------------------------------
TAGS="environment=nonprod,project=rosa,cost-center=platform-engineering,owner=platform-team,red-hat-clustertype=rosa"

#------------------------------------------------------------------------------
# Advanced Settings
#------------------------------------------------------------------------------
# Account role prefix (same as prod)
ACCOUNT_ROLE_PREFIX="ManagedOpenShift"

# OIDC Config (can reuse prod's config - it's marked as reusable)
# Uncomment to use existing OIDC config instead of creating new one
# OIDC_CONFIG_ID="2j8efj68qregg90ldmjcj7nbv0p9t3pf"

# Security settings
FIPS="false"
DISABLE_WORKLOAD_MONITORING="false"

#------------------------------------------------------------------------------
# Reference: Production Cluster ("rosa") Settings
#------------------------------------------------------------------------------
# The following settings are from the prod cluster for reference:
#
# Prod VPC: vpc-0a70417afafb28e82 (ROSA-DEV)
# Prod Subnets: subnet-0609b813c0c9ea063,subnet-0e452618acb9f2150,subnet-0f8a8c62041bd1c24
# Prod Machine CIDR: 10.222.152.0/22
# Prod Pod CIDR: 10.222.160.0/20
# Prod Service CIDR: 10.222.159.0/24
# Prod Host Prefix: /25
# Prod Instance: r6i.metal (128 vCPU, 1TB RAM) - VERY EXPENSIVE
# Prod Access: PrivateLink (API internal only) via Site-to-Site VPN
#
# NETWORKING NOTE:
# Both prod and nonprod clusters use PrivateLink with Site-to-Site VPN for access.
# Nonprod VPC (ROSA-Non-Prod) uses Aviatrix Transit Gateway:
#
#   Aviatrix Transit Gateway: tgw-041316428b4c331d0
#   TGW Attachment:           tgw-attach-0d436f1bee7eb5bd3
#   Route Table:              rtb-0467d201a9cbdb89c
#
# Routing is already configured:
#   - Default route (0.0.0.0/0) via TGW
#   - Corporate networks via TGW
#   - Prod cluster networks via TGW
#------------------------------------------------------------------------------
